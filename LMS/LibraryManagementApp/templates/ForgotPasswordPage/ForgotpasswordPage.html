{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Library Management System</title>
   {% include "_CSSreferences.html" %}
</head>

<body>
   <div id="auth">
      <div class="row h-100">
         <div class="col-lg-5 col-12">
            <div id="auth-left">
               <div class="auth-logo">
                  <a href="#"><img src="{% static 'assets/compiled/svg/logo.svg' %}" alt="Logo"></a>
               </div>
               <h1 class="auth-title">Forgot Password</h1>
               <p>Please enter your email to search for your account.</p>
               <form id="forgot-password-form">
                  <div class="form-group position-relative has-icon-left mb-4">
                     <input type="text" class="form-control form-control-l" id="email" name="email" placeholder="Email"
                        required>
                     <div class="form-control-icon">
                        <i class="bi bi-envelope"></i>
                     </div>
                  </div>
                  <div class="text-center">
                     <!-- Continue Button -->
                     <button class="btn btn-primary btn-block btn-l shadow-lg" id="continue" type="button">Continue</button>
                     
                     <div class="mt-3"></div>
                  
                     <!-- Back to Login Link -->
                     <a href="{% url 'login' %}" class="text-center small" id="back-to-login">‚Üê Back to Login</a>
                  </div>
                  

               </form>
            </div>
         </div>
         <div class="col-lg-7 d-none d-lg-block">
            <div id="auth-right">
            </div>
         </div>
      </div>
   </div>
   {% include "_JSreferences.html" %}
</body>

</html>

<script>
   $(document).ready(function() {
      // Handle the "Continue" button click
      $('#continue').click(function() {
         const email = $('#email').val().trim();

         // Check if the email input is not empty
         if (!email) {
            Swal.fire({
               icon: 'error',
               title: 'Oops...',
               text: 'Please enter your email address.',
            });
            return;
         }

         Swal.fire({
            title: 'Loading...',
            text: 'Please wait a moment',
            allowOutsideClick: false,
            didOpen: () => {
               Swal.showLoading();
            }
         });

         // AJAX request to submit the email for password reset
         $.ajax({
            url: "{% url 'reset-password-request' %}", // Replace with your actual URL name
            method: "POST",
            data: {
               email: email,
               csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function(response) {
               // Display SweetAlert2 success message
               Swal.close()
               Swal.fire({
                  icon: 'success',
                  title: 'Success!',
                  text: response.message,
                  timer: 3000, // Set the timer to 3 seconds
                  showConfirmButton: true, // Show the OK button
                  allowOutsideClick: false, // Prevent closing when clicked outside
               }).then((result) => {
                  // Redirect to login page when user clicks OK
                  if (result.isConfirmed || result.dismiss === Swal.DismissReason.timer) {
                     window.location.href = "{% url 'login' %}";
                  }
               });
            },
            error: function(xhr) {
               Swal.close()
               Swal.fire({
                  icon: 'error',
                  title: 'Oops...',
                  text: xhr.responseJSON.error || "An error occurred. Please try again.",
               });
            }
         });
      });
   });
</script>